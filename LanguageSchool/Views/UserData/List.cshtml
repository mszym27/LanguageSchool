@using PagedList.Mvc;
@model PagedList.IPagedList<LanguageSchool.Models.GetContactInfoListItem>

@using LanguageSchool.Models.ViewModels;

@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    @using (Html.BeginForm())
    {
        DateTime now = DateTime.Now;

        <div class="row thumbnail col-xs-12">
            <div class="row">
                <div class="col-xs-4">
                </div>
                <div class="col-xs-1">
                    @Html.Label("Użytkownik:", new { @style = "float:right" })
                </div>
                <div class="col-xs-3">
                    @Html.TextBox("fullName", null, new { @class = "textarea", @style = "width:300px" })
                </div>
                <div class="col-xs-2">
                    @Html.Label("Typ:", new { @style = "float:right" })
                </div>
                <div class="col-xs-2">
                    <font color="gray">
                        dane @Html.CheckBox("showUserData", true, new { @id = "showUserData", @onchange = "disableButton()" })
                        prośby @Html.CheckBox("showContactRequests", false, new { @id = "showContactRequests", @onchange = "disableButton()" })
                    </font>
                </div>
            </div>
            <p />
            <div class="row">
                <div class="col-xs-2">
                    @Html.Label("Utworzono od:", new { @style = "float:right" })
                </div>
                <div class="col-xs-2">
                    @Html.TextBox("creationDateFrom", (new DateTime(now.Year, now.Month, 1)).ToString("yyyy/MM/dd"), new { @id = "creationDateFrom", @onchange = "disableButton()", @class = "textarea", @style = "width:80px" })
                </div>
                <div class="col-xs-1">
                    @Html.Label("Email:", new { @style = "float:right" })
                </div>
                <div class="col-xs-3">
                    @Html.TextBox("emailAdress", null, new { @class = "textarea", @style = "width:200px" })
                </div>
                <div class="col-xs-2">
                    @Html.Label("Miasto:", new { @style = "float:right" })
                </div>
                <div class="col-xs-2">
                    @Html.TextBox("city", null, new { @class = "textarea", @style = "width:120px" })
                </div>
            </div>
            <p />
            <div class="row">
                <div class="col-xs-2">
                    @Html.Label("Utworzono do:", new { @style = "float:right" })
                </div>
                <div class="col-xs-2">
                    @Html.TextBox("creationDateTo", now.ToString("yyyy/MM/dd"), new { @id = "creationDateTo", @onchange = "disableButton()", @class = "textarea", @style = "width:80px" })
                </div>
                <div class="col-xs-1">
                    @Html.Label("Ulica:", new { @style = "float:right" })
                </div>
                <div class="col-xs-3">
                    @Html.TextBox("street", null, new { @class = "textarea", @style = "width:300px" })
                </div>
                <div class="col-xs-2">
                    @Html.Label("Telefon:", new { @style = "float:right" })
                </div>
                <div class="col-xs-2">
                    @Html.TextBox("phoneNumber", null, new { @class = "textarea", @style = "width:120px" })
                </div>
            </div>
        </div>

    <p />

    <div class="row col-xs-12">
        <div class="col-xs-10">
            @Html.PagedListPager(Model, page => Url.Action("List",
                new
                {
                    creationDateFrom = ViewBag.creationDateFrom,
                    fullName = ViewBag.fullName,
                    city = ViewBag.city,
                    street = ViewBag.street,
                    phoneNumber = ViewBag.phoneNumber,
                    emailAdress = ViewBag.emailAdress,
                    showUserData = ViewBag.showUserData,
                    showContactRequests = ViewBag.showContactRequests,
                    sortColumn = ViewBag.sortColumn,
                    sortDirection = ViewBag.sortDirection,
                    page
                }
            ))
        </div>
        <div class="col-xs-1">
            <button class="btn btn-default" type="reset">Przywróć</button>
        </div>
        <div class="col-xs-1">
            <button class="btn btn-default" id="submit" type="submit">Szukaj</button>
        </div>
    </div>
}

    <p />

        <div class="row thumbnail col-xs-12">
            <table class="table table-striped table-bordered">
                <tr>
                    <th>
                        Utworzono
                    </th>
                    <th>
                        Użytkownik
                    </th>
                    <th>
                        Miasto
                    </th>
                    <th>
                        Ulica
                    </th>
                    <th>
                        Numer telefonu
                    </th>
                    <th>
                        Adres email
                    </th>
                </tr>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @item.CreationDate.ToString("yyyy/MM/dd")
                        </td>
                        <td>
                            @if (item.IsContactRequest == 0)
                            {
                                @Html.ActionLink(item.FullName, "Details", new { id = item.Id })
                            }
                        </td>
                        <td>
                            @item.City
                        </td>
                        <td>
                            @item.Street
                        </td>
                        <td>
                            
                            @if (item.IsContactRequest == 1)
                            {
                                @Html.ActionLink(item.PhoneNumber, "Details", "ContactRequest", new { id = item.Id }, null)
                            }
                            else
                            {
                                @item.PhoneNumber
                            }
                        </td>
                        <td>
                            @item.EmailAdress
                        </td>
                        <td>
                            @if (item.Comment != null)
                            {
                                <label title=@item.Comment><span class="glyphicon glyphicon-comment"></span></label>
                            }
                        </td>
                    </tr>
                }

            </table>
        </div>
    </div>

<script>
    window.onload = disableButton();

    function disableButton() {
        var showUserData = document.getElementById("showUserData");
        var showContactRequests = document.getElementById("showContactRequests");
        var creationDateFrom = document.getElementById("creationDateFrom");
        var creationDateTo = document.getElementById("creationDateTo");

        var submit = document.getElementById("submit");

        if ((!showUserData.checked & !showContactRequests.checked)
            || !creationDateFrom.value || !creationDateTo.value)
            submit.disabled = true;
        else
            submit.disabled = false;
    }
</script>