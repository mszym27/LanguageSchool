@using LanguageSchool.Models.ViewModels

@model LanguageSchool.Models.ViewModels.TestViewModel

@{
    ViewBag.Title = "TakeTest";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm())
{
    int amountOfQuestions = Model.ClosedQuestions.Count;

    <div class="container">
        @Html.HiddenFor(model => model.Id)
        @Html.HiddenFor(model => model.GroupId)

        @if (Model.ClosedQuestions.Any())
        {
            Html.RenderPartial("_PartHeader", "Pytania zamknięte");
            <div class="modal fade" id="confirmation" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Pozostały pytania bez odpowiedzi</h4>
                        </div>
                        <div class="modal-body">
                            <p>W teście niektóre pozostały pytania zamknięte bez zaznaczonych odpowiedzi. Czy jesteś pewien że chcesz go zakończyć?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Anuluj</button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Zakończ test</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" id="closedQuestions">
                <div class="bordered col-md-12">
                    @if (amountOfQuestions > 10)
                    {
                        int anotherHalf = (Model.ClosedQuestions.Count / 2) + 1;

                        <div class="form-group col-md-6" style="border-right: 1px solid lightgray;">
                            <ol>
                                @for (int i = 0; i <= (amountOfQuestions / 2); i++)
                                {
                                    ViewBag.i = i;

                                    @Html.Partial("_PrepareAnswers");
                                }
                            </ol>
                        </div>
                        <div class="form-group col-md-6">
                            <ol start=@anotherHalf>
                                @for (int i = anotherHalf; i < amountOfQuestions; i++)
                                {
                                    ViewBag.i = i;

                                    @Html.Partial("_PrepareAnswers");
                                }
                            </ol>
                        </div>
                    }
                    else
                    {
                        <div class="form-group col-md-12">
                            <ol>
                                @for (int i = 0; i < Model.ClosedQuestions.Count; i++)
                                {
                                    ViewBag.i = i;

                                    @Html.Partial("_PrepareAnswers");
                                }
                            </ol>
                        </div>
                    }
                </div>
            </div>
        }

        @if (Model.OpenQuestions.Any())
        {
            Html.RenderPartial("_PartHeader", "Pytania otwarte");
            <div class="row">
                <div class="bordered col-md-12">
                    @for (int i = 0; i < Model.OpenQuestions.Count; i++)
                    {
                        <div class="form-group">                            
                            @Html.HiddenFor(model => model.OpenQuestions[i].Id)
                            <div class="control-label col-md-12">
                                <strong>@(i + 1). @Model.OpenQuestions[i].Contents</strong>
                            </div>
                            <div class="col-md-12">
                                @Html.EditorFor(model => model.OpenQuestions[i].Answer, new { htmlAttributes = new { @class = "widetextarea", @style = "width:1050px;height:150px" } })
                            </div>
                        </div>

                        <p/>
                    }
                </div>
            </div>
        }
        <div class="row">
            <div class="col-md-3 col-md-offset-9">
                <input onclick = "EndTest()" value="Zakończ test" class="btn btn-block btn-default" />
            </div>
        </div>
    </div>
}


<script>
    function EndTest()
    {
        var closedQuestions = document.getElementById("closedQuestions");

        var inputs = closedQuestions.getElementsByTagName("input");

        var i;

        debugger;

        for (i = 0; i < inputs.length; i++) {
            if (inputs[i].checked == false) {
                $("#confirmation").modal();
                break;
            }
        }
    }
</script>

<style type="text/css">
    div.bordered {
        padding-left: 25px;
        padding-right: 25px;
    }

    ol {
      font-weight: bold;
    }

    ul {
      font-weight: normal;
    }
</style>